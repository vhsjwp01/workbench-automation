#!/usr/bin/ksh

###############################################################
# This script should be run before Build to correct various anomalies in the code.
###############################################################

###############################################################
# PLEASE set the following info for every anomaly this script fixes
###############################################################
# 1.   Short name/description
# 2.   Impacted files/programs/JCLs (by type or specific names if appropriate)
# 3.   Category (product issue, custom requirement we can review and categorize these at a later date if needed)
# 4.   Functional reason for workaround
# 5.   Owner/who added it
# 6.   Project stage it applies to (Cataloger, Convert, Configure, Build, Deploy..)
# 7.   Detailed comments/description as needed
###############################################################

#########################
# Set your current project here
#########################
export PROJECT=/home/oracle/workspace/GRMSPOC

###############################################################
# 1.   This section corrects an error in COBOL-IT where the first line
#      of a copy file is offset by one character
# 2.   *.cpy
# 3.   COBOL-IT limitation
# 4.   Compile time error
# 5.   Jeff Dolberg
# 6.   Pre Build
# 7.
###############################################################
echo "Corrects an error in COBOL where the first line of a copy file is offset"
echo "if the COPY statement immediately follows an 01 level in the program"
#
cd $PROJECT/target/Master-copy/COPY
for i in *.cpy
do
cp --preserve=timestamps $i $i.bak
mv  $i $i.sed22
sed -e"1 s/^/      \n/" <$i.sed22 > $i.sed99

if diff $i.sed99 $i.bak > /dev/null ; then
  cp --preserve=timestamps $i.bak $i
  echo "INFO: Processing " $i " NO CHANGES"
else
  echo "INFO: Processing " $i " UPDATED **************"
  cp $i.sed99 $i
fi
done

###############################################################
# 1.   This section removes a "," which was put into the code during Convert
# 2.   RGUSKEB.cbl
# 3.   Convert workaround
# 4.   Compile time error
# 5.   Jeff Dolberg
# 6.   Pre Build
# 7.
###############################################################
echo "Remove a "," which was put into the code during Convert"
#
cd $PROJECT/target/BATCH
for i in RGUSKEB.cbl
do
cp --preserve=timestamps $i $i.bak
mv  $i $i.sed22
sed -e"s/IF  (Q200-ACT-CASE-TYPE-CD(,2) NUMERIC/IF  (q200-act-case-type-cd(2) numeric /" <$i.sed22 > $i.sed99

if diff $i.sed99 $i.bak > /dev/null ; then
  cp --preserve=timestamps $i.bak $i
  echo "INFO: Processing " $i " NO CHANGES"
else
  echo "INFO: Processing " $i " UPDATED **************"
  cp $i.sed99 $i
fi
done

echo "Insert Display Executing after Procedure Division"
#
export PROJECT=~/workspace/GRMSPOC
for i in *.cbl
do
cp --preserve=timestamps $i $i.bak
#mv  $i $i.sed99
$PROJECT/scripts/custom/AppendUtil $i $i.sed99
if diff $i.sed99 $i.bak > /dev/null ; then
  cp --preserve=timestamps $i.bak $i
  echo "INFO: Processing " $i " NO CHANGES"
else
  echo "INFO: Processing " $i " UPDATED **************"
  cp $i.sed99 $i
fi
done
